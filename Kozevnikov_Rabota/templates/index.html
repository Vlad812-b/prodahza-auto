<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AsiaDrive ‚Äî –ê–≤—Ç–æ–º–æ–±–∏–ª–∏ –∏–∑ –ö–æ—Ä–µ–∏ –∏ –ö–∏—Ç–∞—è</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<header class="site-header">
    <div class="branding">
        <span class="logo">AsiaDrive</span>
        <span class="tagline">–ò–º–ø–æ—Ä—Ç –∞–≤—Ç–æ –∏–∑ –ö–æ—Ä–µ–∏ –∏ –ö–∏—Ç–∞—è</span>
    </div>
    <nav class="main-nav">
        <a href="#catalog">–ö–∞—Ç–∞–ª–æ–≥</a>
        <a href="{{ url_for('tracking_overview') }}">–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ</a>
        <a href="#request">–ü–æ–∫—É–ø–∫–∞</a>
        {% if is_admin %}
            <a href="{{ url_for('leads_list') }}" class="btn btn-outline small">–ó–∞—è–≤–∫–∏ (–∞–¥–º–∏–Ω)</a>
            <a href="{{ url_for('add_car_form') }}" class="btn btn-outline small">–î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ</a>
            <a href="{{ url_for('manage_tracking') }}" class="btn btn-outline small">–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å</a>
        {% elif is_moderator %}
            <a href="{{ url_for('add_car_form') }}" class="btn btn-outline small">–î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ</a>
            <a href="{{ url_for('manage_tracking') }}" class="btn btn-outline small">–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å</a>
        {% elif current_user %}
            <a href="#request" class="btn btn-outline small">–ú–æ—è –∑–∞—è–≤–∫–∞</a>
        {% endif %}
    </nav>
    <div class="auth-controls">
        {% if current_user %}
            <span class="user-pill">
                üë§ {{ current_user['name'] }}
                <span class="role-tag">{{ current_user['role']|capitalize }}</span>
            </span>
            <a href="{{ url_for('logout') }}" class="btn btn-outline small">–í—ã–π—Ç–∏</a>
        {% else %}
            <a href="{{ url_for('login', next=request.full_path) }}" class="link-login">–í–æ–π—Ç–∏</a>
            <a href="{{ url_for('register', next=request.full_path) }}" class="btn small">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
        {% endif %}
    </div>
</header>

<main>
    <section class="hero">
        <div>
            <p class="eyebrow">–£—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç ‚Ä¢ Flask + SQLite</p>
            <h1>–ü–æ–¥–±–µ—Ä—ë–º –∞–≤—Ç–æ–º–æ–±–∏–ª—å –∏–∑ –ö–æ—Ä–µ–∏ –∏–ª–∏ –ö–∏—Ç–∞—è —Å –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–µ–π</h1>
            <p>–ö–∞—Ç–∞–ª–æ–≥ –ø–æ–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é, –∞ –∑–∞—è–≤–∫–∏ —Å—Ä–∞–∑—É –ø–æ–ø–∞–¥–∞—é—Ç –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–æ–µ —É—á–µ–±–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ñ—É–ª–ª—Å—Ç–µ–∫‚Äë–Ω–∞–≤—ã–∫–æ–≤.</p>
            <div class="hero-actions">
                <a class="btn" href="#catalog">–°–º–æ—Ç—Ä–µ—Ç—å –∫–∞—Ç–∞–ª–æ–≥</a>
                <a class="btn btn-outline" href="#request">–û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</a>
            </div>
        </div>
        <div class="hero-card">
            <p>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏:</p>
            <ul>
                {% set snapshot = tracking_map.values() | list %}
                {% if snapshot %}
                    {% for item in snapshot[:3] %}
                    <li><strong>{{ item['status'] }}</strong> ‚Äî {{ item['location'] }}</li>
                    {% endfor %}
                {% else %}
                    <li>–°—Ç–∞—Ç—É—Å—ã –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</li>
                {% endif %}
            </ul>
            <a class="link-login" href="{{ url_for('tracking_overview') }}">–°–º–æ—Ç—Ä–µ—Ç—å –∫–∞—Ä—Ç—É —Å—Ç–∞—Ç—É—Å–æ–≤ ‚Üí</a>
        </div>
    </section>

    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <section class="flash-messages">
        {% for category, message in messages %}
        <div class="flash {{ category }}">{{ message }}</div>
        {% endfor %}
    </section>
    {% endif %}
    {% endwith %}

    <section class="filters">
        <form method="get" action="{{ url_for('index') }}" class="filter-form">
            <label>
                –°—Ç—Ä–∞–Ω–∞
                <select name="country">
                    <option value="">–í—Å–µ</option>
                    {% for country in countries %}
                    <option value="{{ country }}" {% if country == selected_country %}selected{% endif %}>{{ country }}</option>
                    {% endfor %}
                </select>
            </label>
            <label>
                –ú–æ–¥–µ–ª—å –∏–ª–∏ –±—Ä–µ–Ω–¥
                <input type="text" name="q" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, Sonata" value="{{ search_query or '' }}">
            </label>
            <button type="submit" class="btn">–§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å</button>
            <a class="link-reset" href="{{ url_for('index') }}">–°–±—Ä–æ—Å–∏—Ç—å</a>
        </form>
    </section>

    <section id="catalog">
        <div class="section-header">
            <h2>–ö–∞—Ç–∞–ª–æ–≥ –≥–æ—Ç–æ–≤—ã—Ö –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π</h2>
            <p>–í—Å–µ –¥–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –∏–∑ —Ç–∞–±–ª–∏—Ü—ã SQLite ‚Äî –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ –∏ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.</p>
        </div>
        <div class="cars-container">
            {% if cars %}
                {% for car in cars %}
                <article class="car-card">
                    <div class="car-thumb">
                        <img src="{{ car['image_url'] or 'https://placehold.co/600x400?text=AsiaDrive' }}"
                             alt="{{ car['brand'] }} {{ car['model'] }}">
                        <span class="badge">{{ car['country'] }}</span>
                    </div>
                    <div class="car-info">
                        <h3>{{ car['brand'] }} {{ car['model'] }}</h3>
                        <p class="price">${{ "{:,}".format(car['price']) }}</p>
                        <ul class="car-stats">
                            <li><strong>–ì–æ–¥:</strong> {{ car['year'] }}</li>
                            <li><strong>–ü—Ä–æ–±–µ–≥:</strong> {{ "{:,}".format(car['mileage'] or 0) }} –∫–º</li>
                            <li><strong>–¢–æ–ø–ª–∏–≤–æ:</strong> {{ car['fuel_type'] }}</li>
                        </ul>
                        {% set tracking = tracking_map.get(car['id']) %}
                        {% if tracking %}
                        <div class="tracking-chip">
                            <span>{{ tracking['status'] }}</span>
                            <span>‚Ä¢</span>
                            <span>{{ tracking['location'] }}</span>
                            {% if tracking['eta'] %}
                            <span class="eta">ETA {{ tracking['eta'] }}</span>
                            {% endif %}
                        </div>
                        {% else %}
                        <div class="tracking-chip tracking-chip--idle">
                            –°—Ç–∞—Ç—É—Å –¥–æ—Å—Ç–∞–≤–∫–∏ –µ—â—ë –Ω–µ —É–∫–∞–∑–∞–Ω
                        </div>
                        {% endif %}
                        <p class="car-desc">{{ car['description'] or '–û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ —É–∫–∞–∑–∞–Ω–æ.' }}</p>
                        <button class="btn btn-outline" data-car="{{ car['id'] }}" data-car-name="{{ car['brand'] }} {{ car['model'] }}" onclick="prefillCar(this)">–•–æ—á—É —Ç–∞–∫–æ–π</button>
                    </div>
                </article>
                {% endfor %}
            {% else %}
                <div class="empty-state">
                    <p>–ö–∞—Ç–∞–ª–æ–≥ –ø—É—Å—Ç. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª ¬´–î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ¬ª, —á—Ç–æ–±—ã –Ω–∞–ø–æ–ª–Ω–∏—Ç—å –±–∞–∑—É.</p>
                    <a class="btn" href="{{ url_for('add_car_form') }}">–î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å</a>
                </div>
            {% endif %}
        </div>
    </section>

    <section id="request" class="lead-section">
        <div class="section-header">
            <h2>–û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</h2>
            <p>–§–æ—Ä–º–∞ –Ω–∏–∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Å–µ –≤–≤–µ–¥—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü—É `leads`. –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –º–µ–Ω–µ–¥–∂–µ—Ä —É–≤–∏–¥–∏—Ç –∑–∞—è–≤–∫—É –≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–º —Å–ø–∏—Å–∫–µ.</p>
        </div>
        {% set anchor = url_for('index') + '#request' %}
        {% if current_user %}
        <form method="post" action="{{ url_for('create_lead') }}" class="lead-form">
            <div class="form-row">
                <label>
                    –ò–º—è*
                    <input type="text" name="name" required>
                </label>
                <label>
                    –¢–µ–ª–µ—Ñ–æ–Ω*
                    <input type="tel" name="phone" required>
                </label>
                <label>
                    Email
                    <input type="email" name="email">
                </label>
            </div>
            <div class="form-row">
                <label>
                    –í—ã–±—Ä–∞–Ω–Ω—ã–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å
                    <select name="car_id" id="car-select">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞</option>
                        {% for car in cars %}
                        <option value="{{ car['id'] }}">{{ car['brand'] }} {{ car['model'] }}, {{ car['year'] }}</option>
                        {% endfor %}
                    </select>
                </label>
                <label>
                    –ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–π –±—Ä–µ–Ω–¥
                    <input type="text" name="preferred_brand">
                </label>
                <label>
                    –ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å
                    <input type="text" name="preferred_model">
                </label>
            </div>
            <div class="form-row">
                <label>
                    –°—Ç—Ä–∞–Ω–∞ –ø–æ—Å—Ç–∞–≤–∫–∏
                    <select name="preferred_country">
                        <option value="">–ù–µ–≤–∞–∂–Ω–æ</option>
                        <option value="China">–ö–∏—Ç–∞–π</option>
                        <option value="Korea">–ö–æ—Ä–µ—è</option>
                    </select>
                </label>
                <label>
                    –ë—é–¥–∂–µ—Ç ($)
                    <input type="number" name="budget" min="0" step="500">
                </label>
            </div>
            <label>
                –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
                <textarea name="comment" rows="4" placeholder="–û–ø–∏—à–∏—Ç–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è: –≥–æ–¥, –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è, —Ü–≤–µ—Ç..."></textarea>
            </label>
            <button type="submit" class="btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
        </form>
        {% else %}
        <div class="auth-gate">
            <p>–ß—Ç–æ–±—ã –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ –∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∫—É–ø–∫—É, –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç. –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∫–∞—Ç–∞–ª–æ–≥ –∏ —Å—Ç–∞—Ç—É—Å—ã –¥–æ—Å—Ç–∞–≤–∫–∏ –º–æ–∂–Ω–æ –±–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.</p>
            <div class="hero-actions">
                <a class="btn" href="{{ url_for('register', next=anchor) }}">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
                <a class="btn btn-outline" href="{{ url_for('login', next=anchor) }}">–í–æ–π—Ç–∏</a>
            </div>
        </div>
        {% endif %}
    </section>
</main>

<footer class="site-footer">
    <p>AsiaDrive ¬© {{ 2025 }}. –£—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç. –í—Å–µ –¥–∞–Ω–Ω—ã–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ.</p>
</footer>

<script>
function prefillCar(button) {
    const select = document.getElementById('car-select');
    const carId = button.getAttribute('data-car');
    if (select) {
        select.value = carId;
        document.getElementById('request').scrollIntoView({behavior: 'smooth'});
    }
}
</script>
</body>
</html>